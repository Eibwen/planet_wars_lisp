# -*- mode: org -*-
Common Lisp Starter Package for Planet Wars

This file contains specific information about the Common Lisp (CL)
starter package for the [[http://ai-contest.com/][Planet Wars Google AI Challenge]].

* Usage

First, read the [[http://ai-contest.com/using_the_tools.php][Using the Tools]] page on the contest site. This
explains how to run to example bots against each other. The CL starter
package contains the same tools and example bots, so you can use the
same invocation to run an example:

    java -jar tools/PlayGame.jar maps/map7.txt 1000 1000 log.txt "java -jar example_bots/RandomBot.jar" "java -jar example_bots/DualBot.jar" | java -jar tools/ShowGame.jar

*Note*: Java needs to be installed on your system!

The invocation to run the CL bot is almost the same as the above but
replaces the first bot with a call to SBCL and MyBot.lisp.

    java -jar tools/PlayGame.jar maps/map7.txt 1000 1000 log.txt "sbcl --noinform --disable-ldb --lose-on-corruption --end-runtime-options --no-sysinit --disable-debugger --load MyBot.lisp --userinit sbclrc" "java -jar example_bots/DualBot.jar" | java -jar tools/ShowGame.jar

Check the shell scripts in the `bin` directory for more examples on
how to run this bot.

** Bot timing out locally

You will almost certainly need to compile `parse-number.lisp` and
`split-sequence.lisp`, otherwise SBCL will take too long to start up
and your bot will time out. The `bin/compile-libs.sh` script will
compile them.

*Note*: This is not a problem when submitting your code to the server
since it will be compiled first there.


** Submitting the bot

The `bin/make-dist.sh' script creates a zip file that can be used to
submit a bot to the competition. Once submitted your code is compiled
using a Makefile not unlike the one that came with this package, so be
sure to test a compiled version of your bot before submitting.

At the time of this writing I do not know whether SBCL will be run
with a custom dynamic space size so that option is not set yet.

*to do: automatically submit the zip file to the server with `curl`*


** ProxyBot

To make working on your bot a little more natural / lispy I've
included a proxy bot. This bot does nothing in itself except connect
to another bot running at 127.0.0.1:41807 and pass game state and bot
orders back and forth to the game engine and the other bot.

This means you can keep your bot running in a permanent, in my case,
Emacs + Slime session while the proxy bot is the one that gets started
up and shut down every time. So you don't have to recompile your bot
every time in case it times out, but more importantly you don't lose
your bot's state when it crashes since you'll just drop into the
debugger and can inspect the situation.

However, there's a slight speed penalty because of the extra code and
communications.

When running from Slime it is assumed you want to run the proxy bot so
`:pwbot-slime` is set in `*features*`. **Make sure not to use `sbclrc`
from the starter package directory as userinit file! Otherwise
`:pwbot-local` will be set as well and those two interfere.**

*** Running the ProxyBot

*(this section assumes Slime defaults)*

The proxy bot needs to be compiled, otherwise it'll time out at the
start.  The `bin/compile-proxy-bot.sh` script takes care of this.

Start up SBCL with `sbcl --load MyBot.lisp`.  I'm assuming you start
up Swank from your userinit file, if not:

    CL-USER(1): (asdf:oos 'asdf:load-op :swank)
    CL-USER(2): (swank:create-server)

In Emacs do `M-x slime-connect`, go to the Slime REPL, type
`(pwbot::main)` and it should say "Waiting for connection...".  If
not, you've got a problem.

Back on the command line type:

    bin/play-proxy-game.sh maps/map7.txt example_bots/DualBot.jar

and it should run a game.

*** Necessary improvements

* You have to get `(pwbot::main)` (or `(main)` if you're in the PWBOT
  package) from the history every time you want to run a game.  This
  is both annoying and one can't run a whole batch of games from a
  script this way.
